# Практическая работа 4: nest.js, ts, microservices, blockchain, redis

## Задание

Разработать микросервисную архитектуру для получения всех событий для определенного контракта Uniswap в сети Ethereum и сохранения их в БД.

Использовать Nest.js, Infura, web3,js, и любую БД.

Описание сервисов:

1. Harvester - использует cron job чтобы раз в N минут собирать данные и сохранять в БД.
   Events: https://uniswap.org/docs/v2/smart-contracts/pair/
   Pool address: https://info.uniswap.org/pair/0xbb2b8038a1640196fbe3e38816f3e67cba72d940

2. Algo(имитация cpu intensive task) - считает статистику - количество ивентов каждого типа за заданный промежуток времени и кладет результат рассчета в кеш (redis)

3. API Gateway - апи с двумя методами:

`/event/list` - возвращает список ивентов

```
getEvents(type?: EEventTypes): Promise<Array<IEvent>>
```
`/event/summary` - обращается в Algo за статистикой и возвращает пользователю

```
getStats(startDateMs: number, endDateMs: number): Promise<IResponseModel>
```

4. Auth - отвечает за авторизацию и права пользователей.

Возможность регистрации и авторизации с помощью логина и пароля. Есть три группы пользователей - `student`, `developer`, `enterprise`. Группа присваивается рандомно при регистрации. У каждой группы есть ограничения по использованию API.
1. Student: 1000 запросов в месяц, `/event/list` - до 10 ивентов, `/event/summary` - максимальный интервал рассчета 24 часа;
2. Developer: 10000 запросов в месяц, `/event/list` - до 100 ивентов, `/event/summary` - максимальный интервал рассчета 7 дней;
3. Enterprise: 100000 запросов в месяц, `/event/list` - до 1000 ивентов, `/event/summary` - максимальный интервал рассчета не ограничено.

Каждый таск оценивается в определенное количество баллов:

1. Harvester - 40 баллов за реализацию загрузки ивентов, 10 баллов за cron job;
2. Algo - 10 баллов за алгоритм, 10 балов за реализацию кеширования;
3. Gateway API - 10 баллов;
4. Auth - 10 баллов за авторизацию, 10 баллов за реализацию прав пользователя и лимитов API;

Всего 100 баллов. Пороговое значение для успешной защиты - 60. Время на реализацию - 80 рабочих часов. 

Совет: Если не получается реализовать какой-либо сервис, его можно временно замокать (сделать пустышку которая возвращает захардкоженные данные) и поработать над другими частями приложения. 